<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Process Flow</title>
<meta name="description" content="A simple process flow or SCADA diagram editor, simulating equipment monitoring and control." />
<!-- Copyright 1998-2017 by Northwoods Software Corporation. -->
<meta charset="UTF-8">
<script src="go.js"></script>
<script src="goSamples.js"></script>  <!-- this is only for the GoJS Samples framework -->
<script id="code">
  function init() {
    var $ = go.GraphObject.make;  // for more concise visual tree definitions
    myDiagram =
      $(go.Diagram, "myDiagramDiv",
        {
          "grid.visible": false,
          "grid.gridCellSize": new go.Size(30, 20),
          "draggingTool.isGridSnapEnabled": true,
           "toolManager.hoverDelay": 10,
          "resizingTool.isGridSnapEnabled": true,
          "rotatingTool.snapAngleMultiple": 90,
          "rotatingTool.snapAngleEpsilon": 45,
          "undoManager.isEnabled": true

        }
        );

        myDiagram.add(
    $(go.Part, "Auto",
      $(go.Shape, { fill: "beige", stroke: "gray", strokeWidth: 3 }),
      $(go.Panel, "Table",
        $(go.TextBlock, "Java daemon status",
          { row: 0, column: 1, font: "bold 10pt sans-serif", margin: 2 }),
        $(go.TextBlock, "Count",
          { row: 0, column: 2, font: "bold 10pt sans-serif", margin: 2 }),

        // drawn before row 1:
        $(go.RowColumnDefinition,
          { row: 1, separatorStrokeWidth: 1.5, separatorStroke: "black" }),
        // drawn before column 1:
        $(go.RowColumnDefinition,
          { column: 1, separatorStrokeWidth: 1.5, separatorStroke: "black" }),

        $(go.TextBlock, "Running", { row: 1, column: 1, margin: 2 }),
        $(go.TextBlock, "48/71", { row: 1, column: 2, margin: 2 }),
        $(go.TextBlock, "NOT Running", { row: 2, column: 1, margin: 2 }),
        $(go.TextBlock, "21/71", { row: 2, column: 2, margin: 2 }),
        $(go.TextBlock, "UNKNOW", { row: 3, column: 1, margin: 2 }),
        $(go.TextBlock, "2/71", { row: 3, column: 2, margin: 2 })
      )
    ));


        
    // when the document is modified, add a "*" to the title and enable the "Save" button
    myDiagram.addDiagramListener("Modified", function(e) {
      var button = document.getElementById("SaveButton");
      if (button) button.disabled = !myDiagram.isModified;
      var idx = document.title.indexOf("*");
      if (myDiagram.isModified) {
        if (idx < 0) document.title += "*";
      } else {
        if (idx >= 0) document.title = document.title.substr(0, idx);
      }
    });
    
    myDiagram.nodeTemplateMap.add("Process",
      $(go.Node, "Spot",
        {   //locationSpot: new go.Spot( 1,1, 0,0), locationObjectName: "SHAPE",
          resizable: true, resizeObjectName: "SHAPE" ,width:100, height:100},
        new go.Binding("location", "pos", go.Point.parse).makeTwoWay(go.Point.stringify),
        
  $(go.TextBlock,
          { textAlign: "center", stroke: "white",
            editable: true },
          new go.Binding("text").makeTwoWay(),new go.Binding("alignment","align",go.Spot.parse)),

        $(go.Panel, "Spot",
        $(go.Shape, "Cylinder1",
          { name: "SHAPE",
            strokeWidth: 4,
            width: 40,
            height:40,
            fill: $(go.Brush, "Linear",
                    { start: go.Spot.Right, end: go.Spot.Right,
                      0: "gray", 0.5: "white", 1: "gray" }),
            minSize: new go.Size(50, 50),

            portId: "", fromSpot: go.Spot.Top, toSpot: go.Spot.Top,
          },
          new go.Binding("desiredSize", "size", go.Size.parse).makeTwoWay(go.Size.stringify)),

           $(go.Shape, "Circle",
            { name:"SHAPE", width: 15, height: 15, strokeWidth: 1, alignment: go.Spot.TopLeft, alignmentFocus: go.Spot.TopLeft },
            new go.Binding("fill", "color"),
            new go.Binding("stroke", "color")
            ),    
            
             { // this tooltip shows the name and picture of the kitten
            toolTip:
              $(go.Adornment, "Auto",
                $(go.Shape, { fill: "red" }),
                $(go.Panel, "Vertical",
                  $(go.Picture, { margin: 3 },
                    new go.Binding("source", "src", function(s) { return "images/" + s + ".png"; })),
                  $(go.TextBlock, { margin: 3 },
                    new go.Binding("text", "key"))
                ))}
      
        )
      ));

    myDiagram.nodeTemplateMap.add("Valve",
      $(go.Node, "Vertical",
        { locationSpot: new go.Spot(0.5, 1, 0, -21), locationObjectName: "SHAPE",
          selectionObjectName: "SHAPE", rotatable: true },
        new go.Binding("angle").makeTwoWay(),
        new go.Binding("location", "pos", go.Point.parse).makeTwoWay(go.Point.stringify),
        $(go.TextBlock,
          { alignment: go.Spot.Center, textAlign: "center", margin: 5, editable: true },
          new go.Binding("text").makeTwoWay(),
          // keep the text upright, even when the whole node has been rotated upside down
          new go.Binding("angle", "angle", function(a) { return a === 180 ? 180 : 0; }).ofObject()),
        $(go.Shape,
          { name: "SHAPE",
            geometryString: "F1 M0 0 L40 20 40 0 0 20z M20 10 L20 30 M12 30 L28 30",
            strokeWidth: 2,
            fill: $(go.Brush, "Linear", { 0: "gray", 0.35: "white", 0.7: "gray" }),
            portId: "", fromSpot: new go.Spot(1, 0.35), toSpot: new go.Spot(0, 0.35) })
      ));


    myDiagram.linkTemplate =
      $(go.Link,
        { routing: go.Link.AvoidsNodes, curve: go.Link.JumpGap, corner: 1, reshapable: true, toShortLength: 7 },
        new go.Binding("fromSpot", "fromSpot", go.Spot.parse),
        new go.Binding("toSpot", "toSpot", go.Spot.parse),
        new go.Binding("points").makeTwoWay(),

         $(go.TextBlock, { segmentOffset: new go.Point(0, -10)},
          new go.Binding("text","leftRavel")), 

          $(go.TextBlock, { segmentOffset: new go.Point(0, 20)},
          new go.Binding("text","rightRavel")), 



        // mark each Shape to get the link geometry with isPanelMain: true

        // $(go.Shape, { isPanelMain: true, stroke: "black", strokeWidth: 5 }),
        // $(go.Shape, { isPanelMain: true, stroke: "gray", strokeWidth: 3 }), 
        $(go.Shape, { isPanelMain: true, stroke: "green", strokeWidth: 3, name: "PIPE"}
        ,new go.Binding("stroke","color"), new go.Binding("strokeWidth", "width"), new go.Binding("strokeDashArray", "dash")
        ,new go.Binding("fromSpot","fs", go.Spot.parse), new go.Binding("toSpot", "ts", go.Spot.parse)),
       
        $(go.Shape, { toArrow: "", fill: "green", stroke: null, width:4 }
        ,new go.Binding("toArrow","arrow"),new go.Binding("fill","arrowfill"))
      );
    load();
    loop();  // animate some flow through the pipes
  }
  function loop() {
    var diagram = myDiagram;
    setTimeout(function() {
      var oldskips = diagram.skipsUndoManager;
      diagram.skipsUndoManager = true;
      diagram.links.each(function(link) {
          var shape = link.findObject("PIPE");
          var off = shape.strokeDashOffset - 2;
          // console.log(shape);
          shape.strokeDashOffset = (off <= 0) ? 20 : off;
        });
      diagram.skipsUndoManager = oldskips;
      loop();
    }, 100);
  }
  function save() {
    document.getElementById("mySavedModel").value = myDiagram.model.toJson();
    myDiagram.isModified = false;
  }
  function load() {
    myDiagram.model = go.Model.fromJson(document.getElementById("mySavedModel").value);
  }

  

  
</script>

</head>
<body onload="init()">
<div id="sample">
  <div id="myDiagramDiv" style="border: solid 1px black; background-color: deepskyblue;  width:100%; height:600px"></div>
  <p>
    A <em>process flow diagram</em> is commonly used in chemical and process engineering to indicate the general flow of plant processes and equipment.
    A simple SCADA diagram, with animation of the flow along the pipes, is implemented here.
  </p>
  <p>
    The diagram displays the background grid layer by setting <b>grid.visible</b> to true,
    and also allows snapping to the grid using <a>DraggingTool.isGridSnapEnabled</a>,
    <a>ResizingTool.isGridSnapEnabled</a>, and <a>RotatingTool.snapAngleMultiple</a> alongside <a>RotatingTool.snapAngleEpsilon</a>.
  </p>
  <p>
    The diagram also uses the <b>loop</b> function to animate the links by adjusting the <a>Shape.strokeDashOffset</a> every 100 ms.
  </p>
  <div>
    <div>
      <button id="SaveButton" onclick="save()">Save</button>
      <button onclick="load()">Load</button>
      Diagram Model saved in JSON format:
    </div>
    <textarea id="mySavedModel" style="width:100%;height:300px">
      
{ "class": "go.GraphLinksModel",
  "nodeDataArray": [

{"key":"V3", "category":"Process", "pos":"200 120", "text":"Manager", "angle":180, "color":"green"},
{"key":"P2", "category":"Process", "pos":"450 60", "text":"WAS", "color":"green"},
{"key":"P3", "category":"Process", "pos":"600 140", "text":"NoName", "color":"green"},
{"key":"P4", "category":"Process", "pos":"450 140", "text":"AOS", "color":"green"},

{"key":"P5", "category":"Process", "pos":"50 280", "text":"Adapter", "color":"red"},
{"key":"P6", "category":"Process", "pos":"200 280", "text":"Kafka", "color":"green"},
{"key":"P7", "category":"Process", "pos":"450 280", "text":"Spark", "color":"green"},
{"key":"P8", "category":"Process", "pos":"600 280", "text":"RDB-Kafka", "color":"green"},

{"key":"P9", "category":"Process", "pos":"50 420", "text":"No-SQL DB", "color":"yellow","align":"bottom"},
{"key":"P10", "category":"Process", "pos":"200 420", "text":"MEM DB", "color":"green"},
{"key":"P11", "category":"Process", "pos":"450 420", "text":"RDB", "color":"green"},
{"key":"P12", "category":"Process", "pos":"600 420", "text":"Hadoop", "color":"yellow"}
 ],

  "linkDataArray": [
{"from":"P2", "to":"P11","dash":[5,5],  "fromSpot":"Left", "toSpot":"Left"},
{"from":"P4", "to":"P11","dash":[5,5],  "fromSpot":"Left", "toSpot":"Left"},
{"from":"P5", "to":"P6", "color":"red", "dash":[5,5],  "fromSpot":"Right", "toSpot":"Left", "leftRavel":"112 KB/s", "arrow":"Triangle","arrowfill":"red"},
{"from":"P6", "to":"P7","dash":[5,5],  "fromSpot":"Right", "toSpot":"Left", "arrow":"Triangle"},
{"from":"P7", "to":"P8","dash":[5,5],  "fromSpot":"Right", "toSpot":"Left", "leftRavel":"1 MB/s", "arrow":"Triangle"},
{"from":"P7", "to":"P11","width":"3",  "fromSpot":"Bottom", "toSpot":"Top"},

{"from":"P8", "to":"P11",  "fromSpot":"Bottom", "toSpot":"Top", "width": "2"},

{"from":"P3", "to":"P4", "color":"blue", "fromSpot":"Left", "toSpot":"Right", "arrow":"Triangle", "arrowfill":"blue"},
{"from":"P4", "to":"P3", "color":"blue", "fromSpot":"Right", "toSpot":"Left", "arrow":"Triangle","arrowfill":"blue"},


{"from":"P5", "to":"P12", "color":"red", "width":"2",  "fromSpot":"Bottom", "toSpot":"Top" },

{"from":"P9", "to":"P10", "width":"3", "rightRavel":"in:2MB/s \n Out:13MB/s"},
{"from":"P9", "to":"P11", "width":"3"},
{"from":"P9", "to":"P12", "width":"3"},

{"from":"P10", "to":"P9", "width":"3"},
{"from":"P10", "to":"P11", "width":"3"},
{"from":"P10", "to":"P12", "width":"3"},

{"from":"P11", "to":"P9", "width":"3"},
{"from":"P11", "to":"P10", "width":"3"},
{"from":"P11", "to":"P12", "width":"3"},

{"from":"P12", "to":"P9", "width":"3"},
{"from":"P12", "to":"P11", "width":"3"},
{"from":"P12", "to":"P10", "width":"3"}

 ]
}
</textarea>
</div>
</div>
</body>
</html>